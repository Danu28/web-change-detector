<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${report.title}">Enhanced UI Change Analysis Report</title>
    <style>
        /* Phase 3 Enhanced Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header .timestamp {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: 500;
            color: #5d6d7e;
        }
        
        .metric-value {
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .risk-high { color: #e74c3c; }
        .risk-medium { color: #f39c12; }
        .risk-low { color: #27ae60; }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-critical { background: #e74c3c; color: white; }
        .badge-cosmetic { background: #3498db; color: white; }
        .badge-noise { background: #95a5a6; color: white; }
        .badge-structural { background: #9b59b6; color: white; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s ease;
        }
        
        .progress-critical { background: #e74c3c; }
        .progress-cosmetic { background: #3498db; }
        .progress-noise { background: #95a5a6; }
        
        .key-findings {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .key-findings h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .key-findings h3:before {
            content: "üîç";
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .finding-item {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 12px 16px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .category-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .category-title {
            color: #2c3e50;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .category-stats {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .change-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .change-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .change-item:hover {
            background: #e9ecef;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .change-element {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .change-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
        }
        
        .change-property {
            color: #5d6d7e;
        }
        
        .change-values {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .old-value, .new-value {
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }
        
        .old-value {
            background: #ffebee;
            color: #c62828;
        }
        
        .new-value {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .structural-insights {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .pattern-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #9b59b6;
        }
        
        .pattern-type {
            font-weight: 600;
            color: #2c3e50;
            text-transform: capitalize;
        }
        
        .pattern-confidence {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .performance-metrics {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .collapsible {
            cursor: pointer;
            user-select: none;
        }
        
        .collapsible:before {
            content: "‚ñº";
            margin-right: 8px;
            transition: transform 0.3s ease;
        }
        
        .collapsible.collapsed:before {
            transform: rotate(-90deg);
        }
        
        .collapsible-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .summary-grid { grid-template-columns: 1fr; }
            .category-header { flex-direction: column; gap: 10px; }
            .change-details { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 th:text="${report.title}">Enhanced UI Change Analysis Report</h1>
            <div class="timestamp" th:text="'Generated: ' + ${report.formattedGeneratedAt}">Generated: 2025-08-29 14:30:00</div>
        </div>
        
        <!-- Summary Grid -->
        <div class="summary-grid">
            <!-- Overall Summary -->
            <div class="summary-card">
                <h3>üìä Overall Summary</h3>
                <div class="metric">
                    <span class="metric-label">Total Changes</span>
                    <span class="metric-value" th:text="${report.summary.totalChanges}">42</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Overall Risk</span>
                    <span class="metric-value risk-medium" th:text="${report.summary.overallRisk}">MEDIUM</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Match Confidence</span>
                    <span class="metric-value" th:text="${#numbers.formatPercent(report.summary.averageConfidence, 1, 1)}">85.3%</span>
                </div>
            </div>
            
            <!-- Change Distribution -->
            <div class="summary-card">
                <h3>üéØ Change Distribution</h3>
                <div class="metric">
                    <span class="metric-label">Critical</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="metric-value risk-high" th:text="${report.summary.criticalChanges}">8</span>
                        <span class="badge badge-critical" th:text="${report.summary.criticalPercentage + '%'}">19%</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill progress-critical" 
                         th:style="'width: ' + ${report.summary.criticalPercentage} + '%'"></div>
                </div>
                
                <div class="metric">
                    <span class="metric-label">Cosmetic</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="metric-value" th:text="${report.summary.cosmeticChanges}">28</span>
                        <span class="badge badge-cosmetic" th:text="${report.summary.cosmeticPercentage + '%'}">67%</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill progress-cosmetic" 
                         th:style="'width: ' + ${report.summary.cosmeticPercentage} + '%'"></div>
                </div>
                
                <div class="metric">
                    <span class="metric-label">Minor/Noise</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="metric-value" th:text="${report.summary.noiseChanges}">6</span>
                        <span class="badge badge-noise" th:text="${report.summary.noisePercentage + '%'}">14%</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill progress-noise" 
                         th:style="'width: ' + ${report.summary.noisePercentage} + '%'"></div>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="summary-card" th:if="${report.performanceMetrics}">
                <h3>‚ö° Performance</h3>
                <div class="metric">
                    <span class="metric-label">Processing Time</span>
                    <span class="metric-value" th:text="${report.performanceMetrics.formattedProcessingTime}">1.2s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Elements Analyzed</span>
                    <span class="metric-value" th:text="${report.performanceMetrics.elementsAnalyzed}">1,234</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Changes/Second</span>
                    <span class="metric-value" th:text="${#numbers.formatDecimal(report.performanceMetrics.changesPerSecond, 1, 1)}">35.0</span>
                </div>
            </div>
        </div>
        
        <!-- Key Findings -->
        <div class="key-findings">
            <h3>Key Findings</h3>
            <div th:each="finding : ${report.summary.keyFindings}" class="finding-item" th:text="${finding}">
                8 critical changes detected requiring immediate attention
            </div>
        </div>
        
        <!-- Structural Insights -->
        <div class="structural-insights" th:if="${report.structuralInsights}">
            <h3 class="collapsible" onclick="toggleSection('structural')">üèóÔ∏è Structural Analysis</h3>
            <div id="structural" class="collapsible-content">
                <div class="insights-grid">
                    <!-- Structure Metrics -->
                    <div th:if="${report.structuralInsights.hasStructuralChanges()}">
                        <h4>Structure Changes</h4>
                        <div th:each="observation : ${report.structuralInsights.structuralObservations}" 
                             class="finding-item" th:text="${observation}">
                            5 new elements added to the DOM
                        </div>
                    </div>
                    
                    <!-- Identified Patterns -->
                    <div th:if="${!report.structuralInsights.identifiedPatterns.empty}">
                        <h4>Identified Patterns</h4>
                        <div th:each="pattern : ${report.structuralInsights.identifiedPatterns}" class="pattern-card">
                            <div class="pattern-type" th:text="${pattern.patternType}">Navigation</div>
                            <div th:text="${pattern.description}">Navigation elements detected</div>
                            <div class="pattern-confidence" 
                                 th:text="'Confidence: ' + ${#numbers.formatPercent(pattern.confidence, 1, 1)}">Confidence: 90%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Category Sections -->
        <div th:each="section : ${report.categorySections}" class="category-section">
            <div class="category-header">
                <div class="category-title" th:text="${section.categoryName}">Critical Changes</div>
                <div class="category-stats">
                    <span class="badge badge-critical" th:text="${section.changeCount} + ' changes'">8 changes</span>
                    <span class="metric-value risk-high" th:text="${section.riskLevel}">HIGH</span>
                </div>
            </div>
            
            <div class="change-list">
                <div th:each="change : ${section.changes}" class="change-item">
                    <div class="change-element" th:text="${change.element}">div.header > nav.main-nav</div>
                    <div class="change-details">
                        <div>
                            <span class="change-property">Property:</span>
                            <strong th:text="${change.property}">color</strong>
                        </div>
                        <div>
                            <span class="change-property">Type:</span>
                            <strong th:text="${change.changeType}">style</strong>
                        </div>
                        <div>
                            <span class="change-property">Magnitude:</span>
                            <strong th:text="${#numbers.formatDecimal(change.magnitude, 1, 2)}">0.75</strong>
                        </div>
                        <div th:if="${change.matchConfidence != null}">
                            <span class="change-property">Match Confidence:</span>
                            <strong th:text="${#numbers.formatPercent(change.matchConfidence, 1, 1)}">95%</strong>
                        </div>
                    </div>
                    <div class="change-values" th:if="${change.oldValue != null or change.newValue != null}">
                        <span class="old-value" th:text="'Old: ' + ${change.oldValue}">Old: #333</span>
                        <span>‚Üí</span>
                        <span class="new-value" th:text="'New: ' + ${change.newValue}">New: #666</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Report generated by Enhanced UI Tester - Phase 3 Analysis Engine</p>
            <p>Analysis completed in 1.2s</p>
        </div>
    </div>
    
    <script>
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const header = content.previousElementSibling;
            
            content.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }
        
        // Initialize collapsible sections
        document.addEventListener('DOMContentLoaded', function() {
            // Add smooth scrolling and animations
            const cards = document.querySelectorAll('.summary-card, .category-section');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            cards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
            
            // Animate progress bars
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 500);
        });
    </script>
</body>
</html>
